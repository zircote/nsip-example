---
name: EOV Seasonal Reminder

"on":
  schedule:
    # First day of each quarter at 8 AM UTC
    # Mar 1, Jun 1, Sep 1, Dec 1
    - cron: '0 8 1 3,6,9,12 *'

  # Allows manual triggering from the Actions tab
  workflow_dispatch:

jobs:
  create-reminder:
    runs-on: ubuntu-latest
    permissions:
      issues: write

    steps:
      - name: Determine current season
        id: season
        run: |
          MONTH=$(date +%m)
          case $MONTH in
            03|04|05)
              echo "season=Spring" >> $GITHUB_OUTPUT
              ;;
            06|07|08)
              echo "season=Summer" >> $GITHUB_OUTPUT
              ;;
            09|10|11)
              echo "season=Fall" >> $GITHUB_OUTPUT
              ;;
            12|01|02)
              echo "season=Winter" >> $GITHUB_OUTPUT
              ;;
          esac

      - name: Create seasonal monitoring reminder
        uses: actions/github-script@v7
        with:
          script: |
            const season = '${{ steps.season.outputs.season }}';
            const year = new Date().getFullYear();

            const seasonTips = {
              Spring: `
            **What to watch for this season:**
            - New growth emerging -- score warm and cool season grasses
            - Returning wildlife and insect activity
            - Soil moisture levels after winter
            - Any winter erosion damage (rills, gullies)
            - Early weed pressure in crop fields`,
              Summer: `
            **What to watch for this season:**
            - Peak plant growth and canopy cover
            - Heat stress on plants and soil moisture
            - Insect and pollinator activity at its highest
            - Dung beetle activity and decomposition rates
            - Bare soil exposure in grazed areas`,
              Fall: `
            **What to watch for this season:**
            - Seed set and plant senescence
            - Litter accumulation as plants go dormant
            - Soil organism activity slowing down
            - Grazing impact from the season
            - Weed seed banks for next year`,
              Winter: `
            **What to watch for this season:**
            - Ground cover adequacy for winter protection
            - Dormant plant condition
            - Erosion vulnerability on bare or thin areas
            - Wildlife tracks and winter habitat use
            - Soil capping or crusting from freeze-thaw`
            };

            await github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: `EOV ${season} ${year} Monitoring`,
              labels: ['eov', 'seasonal', 'verification'],
              body: `## ${season} ${year} Ecological Monitoring

            It's time to visit your monitoring sites.

            ### Site Checklist

            Visit each site and create a **Site Assessment**:

            - [ ] P-01 -- North paddock
            - [ ] P-02 -- Central paddock
            - [ ] P-03 -- South paddock
            - [ ] P-04 -- West paddock
            - [ ] P-05 -- East paddock
            - [ ] P-06 -- Poultry range
            - [ ] C-01 -- Market garden north
            - [ ] C-02 -- Market garden south
            - [ ] R-01 -- Creek crossing north
            - [ ] R-02 -- Creek bend south
            - [ ] W-01 -- North woodlot
            - [ ] W-02 -- West windbreak

            ### Photo Points

            Take photos at each site:
            - [ ] Create a **Photo Point** record per site

            ${seasonTips[season]}

            ### How to Record

            1. Go to **Issues** > **New issue**
            2. Choose **EOV Site Assessment** for each site
            3. Choose **EOV Photo Point** for each photo

            Need help? See the runbook:
            docs/runbooks/recording-a-site-assessment.md

            ### After All Sites Are Done

            Request a **Seasonal Summary**:
            1. Go to **Issues** > **New issue** > **EOV Action**
            2. Choose "Seasonal Summary"
            3. Select "${season}" as the season

            ---
            *Created automatically by GitHub Actions.*
            `
            });
